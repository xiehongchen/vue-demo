{"version":3,"file":"useTable-CMAMVJr0.js","sources":["../../src/apis/person/index.ts","../../src/hooks/useTable.ts","../../src/hooks/usePagination.ts"],"sourcesContent":["/*\n * @Author: xiehongchen 1754581057@qq.com\n * @Date: 2024-03-04 17:28:05\n * @LastEditors: xiehongchen 1754581057@qq.com\n * @LastEditTime: 2024-03-05 10:48:36\n * @FilePath: /vue-demo/src/apis/person/index.ts\n * @Description: \n * 认真学习每一天\n */\nimport useRequest from '@/utils/axios/index'\nimport type * as Person from './type'\n\nexport function getPersonList(data: {\n  name?: string,\n  status?: string,\n  current: number,\n  pageSize: number\n}) {\n  return useRequest.get<PageRes<Person.PersonItem[]>>({\n    url: '/person/list',\n    params: data\n  })\n}","import usePagination from './usePagination'\nimport { ref } from 'vue'\n\ninterface Options<T> {\n  formatResult: (data: T[]) => any\n  onSuccess?: () => void\n  immediate?: boolean\n  rowkey?: keyof T\n}\n\ntype PaginationParams = {\n  page: number\n  size: number\n}\n\n/**\n * Api<T> 泛型类型，接受一个类型参数T\n * params: PaginationParams 函数类型的签名部分，表示函数接受一个参数params\n * Promise<ApiRes<PageRes<T[]>>>  函数的返回类型，表示一个promise对象，\n * 该promise解析的值是一个ApiRes对象，这个APiRes对象包含一个PageRes<T[]>类型的数据\n */\ntype Api<T> = (params: PaginationParams) => Promise<ApiRes<PageRes<T[]>>>\n\nexport default function <T>(api: Api<T>, options?: Options<T>) {\n  const { formatResult, onSuccess, immediate } = options || {}\n  const { pagination, setTotal, changeCurrent, changePageSize } = usePagination(() => getTableData())\n  const loading = ref(false)\n  const tableData = ref<T[]>([])\n\n  // 获取数据\n  const getTableData = async () => {\n    try {\n      loading.value = true\n      const res = await api({\n        page: pagination.current,\n        size: pagination.pageSize\n      })\n      console.log('res', res)\n      tableData.value = formatResult ? formatResult(res.data.records) : res.data.records\n      setTotal(res.data.total)\n      onSuccess && onSuccess()\n    } finally {\n      loading.value = false\n    }\n  }\n\n  // 是否立即获取数据\n  const isImmediate = immediate ?? true\n  isImmediate && getTableData()\n\n  return {\n    loading,\n    tableData,\n    getTableData,\n    changeCurrent,\n    changePageSize,\n    pagination\n  }\n\n}","import { reactive, toRefs } from \"vue\"\n\n// 回调函数\ntype Callback = () => void\n\n// 请求参数\ntype Options = {\n  defaultPageSize: number\n}\n\nexport default function usePagination(callback: Callback, options: Options = { defaultPageSize: 10 }) {\n  const pagination = reactive({\n    showPageSize: true,\n    showTotal: true,\n    current: 1,\n    pageSize: options.defaultPageSize,\n    total: 0,\n    onChange: (size: number) => {\n      pagination.current = size\n      callback && callback()\n    },\n    onPageSizeChange: (size: number) => {\n      pagination.current = 1\n      pagination.pageSize = size\n      callback && callback()\n    }\n  })\n\n  const changeCurrent = pagination.onChange\n  const changePageSize = pagination.onPageSizeChange\n\n  function setTotal(value: number) {\n    pagination.total = value\n  }\n\n  const { current, pageSize, total } = toRefs(pagination)\n\n  return {\n    current,\n    pageSize,\n    total,\n    pagination,\n    changeCurrent,\n    changePageSize,\n    setTotal\n  }\n}"],"names":["getPersonList","data","useRequest","get","url","params","useTable","api","options","formatResult","onSuccess","immediate","pagination","setTotal","changeCurrent","changePageSize","callback","defaultPageSize","reactive","showPageSize","showTotal","current","pageSize","total","onChange","size","onPageSizeChange","toRefs","value","usePagination","getTableData","loading","ref","tableData","async","res","page","records"],"mappings":"gGAYO,SAASA,EAAcC,GAM5B,OAAOC,EAAWC,IAAkC,CAClDC,IAAK,eACLC,OAAQJ,GAEZ,CCCA,SAAAK,EAA4BC,EAAaC,GACvC,MAAMC,aAAEA,EAAcC,UAAAA,EAAAC,UAAWA,GAAcH,GAAW,CAAA,GACpDI,WAAEA,WAAYC,EAAUC,cAAAA,EAAAC,eAAeA,GCf/C,SAAsCC,EAAoBR,EAAmB,CAAES,gBAAiB,KAC9F,MAAML,EAAaM,EAAS,CAC1BC,cAAc,EACdC,WAAW,EACXC,QAAS,EACTC,SAAUd,EAAQS,gBAClBM,MAAO,EACPC,SAAWC,IACTb,EAAWS,QAAUI,EACrBT,GAAYA,GAAS,EAEvBU,iBAAmBD,IACjBb,EAAWS,QAAU,EACrBT,EAAWU,SAAWG,EACtBT,GAAYA,GAAS,IAInBF,EAAgBF,EAAWY,SAC3BT,EAAiBH,EAAWc,kBAM5BL,QAAEA,EAASC,SAAAA,EAAAC,MAAUA,GAAUI,EAAOf,GAErC,MAAA,CACLS,UACAC,WACAC,QACAX,aACAE,gBACAC,iBACAF,SAbF,SAAkBe,GAChBhB,EAAWW,MAAQK,CACrB,EAaF,CDrBkEC,EAAc,IAAMC,MAC9EC,EAAUC,GAAI,GACdC,EAAYD,EAAS,IAGrBF,EAAeI,UACf,IACFH,EAAQH,OAAQ,EACV,MAAAO,QAAY5B,EAAI,CACpB6B,KAAMxB,EAAWS,QACjBI,KAAMb,EAAWU,WAGTW,EAAAL,MAAQnB,EAAeA,EAAa0B,EAAIlC,KAAKoC,SAAWF,EAAIlC,KAAKoC,QAClExB,EAAAsB,EAAIlC,KAAKsB,OAClBb,GAAaA,GAAU,CACvB,QACAqB,EAAQH,OAAQ,CAClB,GAOK,OAHajB,IAAa,IAClBmB,IAER,CACLC,UACAE,YACAH,eACAhB,gBACAC,iBACAH,aAGJ"}