{"version":3,"file":"index-CbY0ttQp.js","sources":["../../src/views/home/index.vue"],"sourcesContent":["<template>\n  <div class=\"page\">\n    <div class=\"upload-box\">\n      <div class=\"upload\">\n        <a-upload-dragger\n          v-model:fileList=\"fileList\"\n          name=\"file\"\n          :multiple=\"true\"\n          listType=\"picture-card\"\n          :before-upload=\"beforeUpload\" \n          @remove=\"handleRemove\"\n          @preview=\"handlePreview\"\n        >\n          <p class=\"ant-upload-drag-icon\">\n            <inbox-outlined></inbox-outlined>\n          </p>\n          <p class=\"ant-upload-text\">点击或拖动文件到该区域上传</p>\n          <p class=\"ant-upload-hint\">\n            支持单次或批量上传\n          </p>\n        </a-upload-dragger>\n      </div>\n    </div>\n    <div class=\"select-box\">\n      <a-transfer\n        v-model:target-keys=\"targetKeys\"\n        :titles=\"['上传', '展示']\"\n        :data-source=\"fileList\"\n        :list-style=\"{\n          width: '300px',\n          height: '300px',\n        }\"\n        @change=\"handleChange\"\n      >\n        <template #render=\"item\">\n          <div style=\"text-align: left\">\n            <a-image :width=\"40\" :height=\"40\" :src=\"item.preview\"></a-image>\n            <span class=\"custom-item\" style=\"color: red\">{{ item.name }}</span>\n          </div>\n        </template>\n      </a-transfer>\n    </div>\n    <div class=\"show-box\">\n      <div v-for=\"item in imgList\" :key=\"item.index\" class=\"box\">\n        <div\n          class=\"item\"\n          :draggable=\"item.image ? true : false\"\n          @dragstart=\"dragStart(item, $event)\"\n          @dragover=\"dragOver($event)\"\n          @drop=\"drop(item, $event)\"\n          @dragend=\"dragEnd\"\n        >\n          <template v-if=\"item.image\">\n              <img style=\"width: 100px; height: 100px;\" :src=\"item.image\" />\n          </template>\n          <template v-else>\n            {{ item.index }}\n          </template>\n        </div>\n      </div>\n    </div>\n    <a-modal :open=\"previewVisible\" :title=\"previewTitle\" :footer=\"null\" @cancel=\"handleCancel\">\n      <img alt=\"example\" style=\"width: 100%\" :src=\"previewImage\" />\n    </a-modal>\n  </div>\n</template>\n<script setup lang=\"ts\">\nimport { ref } from 'vue';\n\n// 上传区域\nimport { InboxOutlined } from '@ant-design/icons-vue';\nimport type { UploadProps } from 'ant-design-vue';\n\nconst fileList = ref<UploadProps['fileList']>([]);\n\nconst handleRemove: UploadProps['onRemove'] = file => {\n  const index = fileList.value!.indexOf(file);\n  const newFileList = fileList.value!.slice();\n  newFileList.splice(index, 1);\n  fileList.value = newFileList;\n};\n\nconst beforeUpload: UploadProps['beforeUpload'] = async (file: any) => {\n  if (!file.url && !file.preview) {\n    file.preview = (await getBase64(file)) as string;\n  }\n  file.key = file.uid\n  fileList.value = [...(fileList.value || []), file];\n  return false;\n};\nconst previewVisible = ref(false);\nconst previewImage = ref('');\nconst previewTitle = ref('');\n\nconst handlePreview = async (file: any) => {\n  if (!file.url && !file.preview) {\n    file.preview = (await getBase64(file.originFileObj)) as string;\n  }\n  previewImage.value = file.url || file.preview;\n  previewVisible.value = true;\n  previewTitle.value = file.name || file.url.substring(file.url.lastIndexOf('/') + 1);\n};\nconst handleCancel = () => {\n  previewVisible.value = false;\n  previewTitle.value = '';\n};\n\nfunction getBase64(file: File) {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.readAsDataURL(file);\n    reader.onload = () => resolve(reader.result);\n    reader.onerror = error => reject(error);\n  });\n}\n\n// 筛选区域\nconst targetKeys = ref<string[]>();\n\n\nconst handleChange = (nextTargetKeys: string[], direction: string, moveKeys: string[]) => {\n  console.log('nextTargetKeys', nextTargetKeys, direction, moveKeys)\n  const list = fileList.value?.filter((item: any )=> nextTargetKeys.includes(item.key)) as any[]\n  console.log('list', list)\n  let hasImage = imgList.value.filter(item => item.image)\n  console.log('hasImage', hasImage)\n  if (hasImage.length > 0) {\n    let listKeys = list.map(item => item.key)\n    imgList.value = imgList.value.map(imgItem => {\n      // 如果该key有值，且list不存在该key，image置空\n      if (imgItem.key && !listKeys.includes(imgItem.key)) {\n        return { ...imgItem, image: '', key: '' }\n      }\n      if (listKeys.includes(imgItem.key)) {\n        // 过滤掉已经存在的key\n        listKeys = listKeys.filter(key => key !== imgItem.key)\n      }\n      console.log('listKeys', listKeys)\n      return imgItem\n    })\n    console.log('listKeys', listKeys)\n    // 如果存在没有的key，就按顺序加上\n    if (listKeys.length) {\n      for (let i = 0; i < listKeys.length; i++) {\n        const index = imgList.value.findIndex(item => item.key === '')\n        const item = list.find(item => item.key == listKeys[i])\n        console.log('index', index)\n        imgList.value[index].image = item.preview\n        imgList.value[index].key = item.key\n      }\n    }\n  } else {\n    for (let i = 0; i < list!.length; i++) {\n      imgList.value[i].image = list[i].preview\n      imgList.value[i].key = list[i].key\n    }\n  }\n  hasImage  = imgList.value.filter(item => item.image)\n  console.log('hasImage', hasImage)\n};\n// 展示区域\nlet imgList = ref([\n  { index: 1, image: '', key: '' },\n  { index: 2, image: '', key: '' },\n  { index: 3, image: '', key: '' },\n  { index: 4, image: '', key: '' },\n  { index: 5, image: '', key: '' },\n  { index: 6, image: '', key: '' },\n  { index: 7, image: '', key: '' },\n  { index: 8, image: '', key: '' },\n  { index: 9, image: '', key: '' },\n  { index: 10, image: '', key: '' },\n  { index: 11, image: '', key: '' },\n  { index: 12, image: '', key: '' },\n  { index: 13, image: '', key: '' },\n  { index: 14, image: '', key: '' },\n  { index: 15, image: '', key: '' },\n  { index: 16, image: '', key: '' },\n  { index: 17, image: '', key: '' },\n  { index: 18, image: '', key: '' },\n  { index: 19, image: '', key: '' },\n  { index: 20, image: '', key: '' }\n]);\n\nlet dragItem = ref(null);\n\nfunction dragStart(item: any, event: any) {\n  console.log('dragStart', item, event);\n  dragItem.value = item;\n  event.dataTransfer.effectAllowed = 'move';\n  event.dataTransfer.setData('text/plain', JSON.stringify(item));\n}\n\nfunction dragOver(event: any) {\n  event.preventDefault();\n  event.dataTransfer.dropEffect = 'move';\n}\n\nfunction drop(item: any, event: any) {\n  event.preventDefault();\n  const data = JSON.parse(event.dataTransfer.getData('text/plain'));\n  console.log('data', data, item);\n  const index1 = imgList.value.findIndex((i) => i.index === item.index);\n  const index2 = imgList.value.findIndex((i) => i.index === data.index);\n  console.log('index', index1, index2)\n  if (index1 > -1 && index2 > -1) {\n    // 交换两个图片的 index 属性\n    const temp = { ...imgList.value[index1] }\n    imgList.value[index1].image = imgList.value[index2].image;\n    imgList.value[index1].key = imgList.value[index2].key;\n    imgList.value[index2].image = temp.image;\n    imgList.value[index2].key = temp.key;\n    console.log('imgList', imgList.value, temp)\n  }\n}\n\nfunction dragEnd() {\n  dragItem.value = null;\n}\n</script>\n<style lang=\"scss\" scoped>\n.page {\n  padding: 16px;\n  display: flex;\n\n  .upload-box {\n    flex: 1;\n    :deep(.ant-upload-list) {\n      height: 240px;\n      overflow: auto;\n      display: flex;\n      flex-wrap: wrap;\n      .ant-upload-list-item-container {\n        width: 32%;\n        &:nth-of-type(3n-1) {\n          margin: 0 2%;\n        }\n      }\n    }\n  }\n\n  .show-box {\n    display: grid;\n    grid-template-columns: repeat(5, 1fr);\n    column-gap: 10px;\n    row-gap: 10px;\n    .box {\n      border: 1px solid #eee;\n      border-radius: 8px;\n      width: 120px;\n      height: 120px;\n      transition: transform 0.3s ease; // 添加过渡效果\n    }\n\n    .item {\n      font-size: 20px;\n      width: 120px;\n      height: 120px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      padding: 10px;\n    }\n  }\n  .select-box {\n    flex: 1;\n    padding: 0 50px;\n  }\n}\n</style>\n"],"names":["fileList","ref","handleRemove","file","index","value","indexOf","newFileList","slice","splice","beforeUpload","async","url","preview","getBase64","key","uid","previewVisible","previewImage","previewTitle","handlePreview","originFileObj","name","substring","lastIndexOf","handleCancel","Promise","resolve","reject","reader","FileReader","readAsDataURL","onload","result","onerror","error","targetKeys","handleChange","nextTargetKeys","direction","moveKeys","list","_a","filter","item","includes","hasImage","imgList","image","length","listKeys","map","imgItem","i","findIndex","find","dragItem","dragEnd","event","dataTransfer","effectAllowed","setData","JSON","stringify","preventDefault","dropEffect","data","parse","getData","index1","index2","temp"],"mappings":"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"}